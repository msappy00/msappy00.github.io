(function(b){b.fn.bPopup=function(w,C){function J(){a.contentContainer=b(a.contentContainer||c);switch(a.content){case "iframe":b('<iframe class="b-iframe" '+a.iframeAttr+"></iframe>").appendTo(a.contentContainer);p=c.outerHeight(!0);q=c.outerWidth(!0);x();b(".b-iframe").attr("src",a.loadUrl);j(a.loadCallback);break;case "image":x();b("<img />").load(function(){j(a.loadCallback);D(b(this))}).attr("src",a.loadUrl).hide().appendTo(a.contentContainer);break;default:x(),b('<div class="b-ajax-wrapper"></div>').load(a.loadUrl,
a.loadData,function(d,c){j(a.loadCallback,c);D(b(this))}).hide().appendTo(a.contentContainer)}}function x(){a.modal&&b('<div class="b-modal '+f+'"></div>').css({backgroundColor:a.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:a.zIndex+r}).appendTo(a.appendTo).fadeTo(a.speed,a.opacity);A();c.data("bPopup",a).data("id",f).css({left:a.transition=="slideIn"||a.transition=="slideBack"?a.transition=="slideBack"?e.scrollLeft()+s:(t+q)*-1:k(!(!a.follow[0]&&l||g)),position:a.positionStyle||
"absolute",top:a.transition=="slideDown"||a.transition=="slideUp"?a.transition=="slideUp"?e.scrollTop()+u:v+p*-1:m(!(!a.follow[1]&&n||g)),"z-index":a.zIndex+r+1}).each(function(){a.appending&&b(this).appendTo(a.appendTo)});E(!0)}function o(){a.modal&&b(".b-modal."+c.data("id")).fadeTo(a.speed,0,function(){b(this).remove()});a.scrollBar||b("html").css("overflow","auto");b(".b-modal."+f).unbind("click");e.unbind("keydown."+f);i.unbind("."+f).data("bPopup",i.data("bPopup")-1>0?i.data("bPopup")-1:null);
c.undelegate(".bClose, ."+a.closeClass,"click."+f,o).data("bPopup",null);clearTimeout(F);E();return!1}function G(d){u=i.height();s=i.width();h=B();if(h.x||h.y)clearTimeout(H),H=setTimeout(function(){A();d=d||a.followSpeed;var z={};if(h.x)z.left=a.follow[0]?k(!0):"auto";if(h.y)z.top=a.follow[1]?m(!0):"auto";c.dequeue().each(function(){g?b(this).css({left:t,top:v}):b(this).animate(z,d,a.followEasing)})},50)}function D(d){var b=d.width(),f=d.height(),e={};a.contentContainer.css({height:f,width:b});if(f>=
c.height())e.height=c.height();if(b>=c.width())e.width=c.width();p=c.outerHeight(!0);q=c.outerWidth(!0);A();a.contentContainer.css({height:"auto",width:"auto"});e.left=k(!(!a.follow[0]&&l||g));e.top=m(!(!a.follow[1]&&n||g));c.animate(e,250,function(){d.show();h=B()})}function K(){i.data("bPopup",r);c.delegate(".bClose, ."+a.closeClass,"click."+f,o);a.modalClose&&b(".b-modal."+f).css("cursor","pointer").bind("click",o);!L&&(a.follow[0]||a.follow[1])&&i.bind("scroll."+f,function(){if(h.x||h.y){var d=
{};if(h.x)d.left=a.follow[0]?k(!g):"auto";if(h.y)d.top=a.follow[1]?m(!g):"auto";c.dequeue().animate(d,a.followSpeed,a.followEasing)}}).bind("resize."+f,function(){G()});a.escClose&&e.bind("keydown."+f,function(a){a.which==27&&o()})}function E(d){function b(e){c.css({display:"block",opacity:1}).animate(e,a.speed,a.easing,function(){I(d)})}switch(d?a.transition:a.transitionClose||a.transition){case "slideIn":b({left:d?k(!(!a.follow[0]&&l||g)):e.scrollLeft()-(q||c.outerWidth(!0))-y});break;case "slideBack":b({left:d?
k(!(!a.follow[0]&&l||g)):e.scrollLeft()+s+y});break;case "slideDown":b({top:d?m(!(!a.follow[1]&&n||g)):e.scrollTop()-(p||c.outerHeight(!0))-y});break;case "slideUp":b({top:d?m(!(!a.follow[1]&&n||g)):e.scrollTop()+u+y});break;default:c.stop().fadeTo(a.speed,d?1:0,function(){I(d)})}}function I(b){b?(K(),j(C),a.autoClose&&(F=setTimeout(o,a.autoClose))):(c.hide(),j(a.onClose),a.loadUrl&&(a.contentContainer.empty(),c.css({height:"auto",width:"auto"})))}function k(a){return a?t+e.scrollLeft():t}function m(a){return a?
v+e.scrollTop():v}function j(a,e){b.isFunction(a)&&a.call(c,e)}function A(){v=n?a.position[1]:Math.max(0,(u-c.outerHeight(!0))/2-a.amsl);t=l?a.position[0]:(s-c.outerWidth(!0))/2;h=B()}function B(){return{x:s>c.outerWidth(!0),y:u>c.outerHeight(!0)}}b.isFunction(w)&&(C=w,w=null);var a=b.extend({},b.fn.bPopup.defaults,w);a.scrollBar||b("html").css("overflow","hidden");var c=this,e=b(document),i=b(window),u=i.height(),s=i.width(),L=/OS 6(_\d)+/i.test(navigator.userAgent),y=200,r=0,f,h,n,l,g,v,t,p,q,H,
F;c.close=function(){o()};c.reposition=function(a){G(a)};return c.each(function(){b(this).data("bPopup")||(j(a.onOpen),r=(i.data("bPopup")||0)+1,f="__b-popup"+r+"__",n=a.position[1]!=="auto",l=a.position[0]!=="auto",g=a.positionStyle==="fixed",p=c.outerHeight(!0),q=c.outerWidth(!0),a.loadUrl?J():x())})};b.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",autoClose:!1,closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,
iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:0.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:9997}})(jQuery);
