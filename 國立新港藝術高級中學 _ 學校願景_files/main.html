
<!-- saved from url=(0148)https://www.sgash.cyc.edu.tw/ischool/widget/activities2/main.php?fw=850&fh=250&bid=0&uid=WID_0_20_cd5b990ed23629f17be17e5d90035ec683d2946f&preview=0 -->
<html lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>活動花絮II</title>
<link href="./layout(29).css" type="text/css" rel="stylesheet">
<script type="text/javascript" src="./jquery.js(1).download"></script>
<script type="text/javascript" src="./jquery.timer.js.download"></script>
<script type="text/javascript">
var g_unique_id = "WID_0_20_cd5b990ed23629f17be17e5d90035ec683d2946f";
var g_per_slide_width = parseInt("154");
var g_per_slide_height = parseInt("125");
var g_slide_width = 0;
var g_show_album_title = parseInt("0");
var g_autoplay_timer;
var g_autoplay_interval = parseInt("6") * 1000;
var g_is_rwd_page = parent.is_rwd_page();

function query_album() {
	
	var keyword = $("#keyword").val();
	
	var param = {};
	param.paction = "query_album";
	param.uid = "WID_0_20_cd5b990ed23629f17be17e5d90035ec683d2946f";
	param.pageNum = parseInt($("#pageNum").val());
	param.maxRows = parseInt($("#maxRows").val());
	param.keyword = encodeURIComponent(keyword);
	param.ws_width = g_per_slide_width;
	param.ws_height = g_per_slide_height;
	
	$.ajax({
		url: 'main.php',
	  	data: param,
	  	type: 'POST',
	  	dataType: 'json',
	  	timeout: 20000,
		error: function(){
			//alert('Error loading JSON data');
		},
		success: function(json_data){
			var maxRows = json_data[0].maxRows;
			var pageNum = json_data[0].pageNum;
			var totalpage = json_data[0].totalPages;
			var slideAnim = $("#slide_anim").val();
			var html_slide = gen_slide_html(json_data);
			
			if(slideAnim=="right"){
				$("#slideInner").css('marginLeft', -g_slide_width);
				$("#slideInner").prepend(html_slide);
			}
			else if(slideAnim=="left"){
				$("#slideInner").append(html_slide);
			}
			else if(slideAnim=="fadeout"){
				$("#slideInner").append(html_slide);
			}
			else{
				$("#slideInner").empty();
				$("#slideInner").append(html_slide);
			}
			
			// Wrap all .slides with #slideInner div
		  	$(".slide").css({
		      'float' : 'left',
		      'width' : g_slide_width
		    });
			
			$("#pageNum").val(pageNum);
			$("#totalPages").val(totalpage);
			
			manageControls();
			
			// $(".album_title_block").each(function(){
			// 	var album_title_height = $(this).find("div").height();
			// 	var block_height = $(this).height();
			// 	var offset = block_height - album_title_height;
			// 	$(this).find("div").css("bottom", offset);

			// 	$(this).mouseenter(function(){
			// 		var album_title_height = $(this).find("div").height();
			// 		var block_height = $(this).height();
			// 		if(block_height<album_title_height)
			// 			$(this).find("div").css("bottom", 0);
			// 	});

			// 	$(this).mouseleave(function(){
			// 		var album_title_height = $(this).find("div").height();
			// 		var block_height = $(this).height();
			// 		var offset = block_height - album_title_height;
			// 		$(this).find("div").css("bottom", offset);
			// 	});
			// });
			
			$(".album_title_block").each(function() {
				var w = $(this).width() - 24;
				$(this).find(".info").css("width", w);
				$(this).find(".title").css("width", w);
			});
			
			$(".slide_image").mouseenter(function() {
				var _this_album_title_block = $(this).find(".album_title_block");

				$(".album_title_block").each(function() {
					$(this).removeClass("over-album-x");
				});

				_this_album_title_block.addClass("over-album-x");

				var target_height = $(this).height();
				_this_album_title_block.animate({
					top: 0,
					height: target_height
				}, 100, function() {
					$(".album_title_block").each(function() {
						if(!$(this).hasClass("over-album-x")) {
							$(this).css("top", "unset");
							$(this).css("height", 43);
							$(this).css("bottom", 0);
						}
					});
				});
			});

			$("#slideshow").mouseleave(function(){
				$(".album_title_block").each(function() {
					$(this).css("top", "unset");
					$(this).css("height", 43);
					$(this).css("bottom", 0);
				});
			});

			if( $('.slide').length>1 ){
				if(slideAnim=="right"){
					$('#slideInner').fadeIn();
					
					$('#slideInner').animate({
						'marginLeft' : 0
					}, 500, function(){
						$(".slide").last().remove();
						$("#slideInner").css('marginLeft', 0);
					});
					
					return;
				}
				else if(slideAnim=="left"){
					$('#slideInner').fadeIn();
					
					$('#slideInner').animate({
						'marginLeft' : -g_slide_width
					}, 500, function(){
						$(".slide").first().remove();
						$("#slideInner").css('marginLeft', 0);
					});
					
					return;
				}
				else if(slideAnim=="fadeout"){
					$('#slideInner').fadeOut(500, function(){
						$(".slide").first().remove();
						$("#slideInner").css('marginLeft', 0);
						$("#slideInner").fadeIn();
					});
					
					return;
				}
			}
			
			if(parent.onWidgetloaded){
				parent.onWidgetloaded(g_unique_id);
			}
		}
	});
}

function gen_slide_html(json_data){
	var data = '';
		
	data += '<div class="slide">';
	
	for(var i=1; i<json_data.length; i++){
		var album_id = json_data[i].album_id;
		var album_title = json_data[i].album_title;
		var album_cover = json_data[i].album_cover;
		var thumb_image = json_data[i].thumb_image;
		var thumb_style = json_data[i].style;
		var url = 'https://www.sgash.cyc.edu.tw/ischool/public/AlbumViewer/index.php?aid=' + album_id + "&col=4&maxRows=0";
		
		album_title += "(另開啟新視窗)";
		
		data += '<a href="' + url + '" target="_blank" class="tab-ctl-x">';
		data += '<div class="slide_image" style="width:' + g_per_slide_width + 'px;height:' + g_per_slide_height + 'px;">';
		data += '<img src="' + thumb_image + '"';
		data += ' title="' + album_title + '"';
		
		if (g_show_album_title==1) {
			data += ' alt=""';
		}
		else {
			data += ' alt="' + album_title + '"';
		}

		data += ' style="' + thumb_style + '">';
		
		if(g_show_album_title==1){
			data += '<div class="album_title_block" title="' + album_title + '"';
			data += '>';
			data += '<div class="title">' + album_title + '</div>';
			data += '</div>';
		}
		
		// data += '</a>';
		data += '</div>';
		data += '</a>';
	}
	
	data += '</div>';
	
	return data;
}

function manageControls(){
  	var pos = parseInt($("#pageNum").val());
   	var totalPages = parseInt($("#totalPages").val());
    
    // Hide left arrow if position is first slide	
    if(pos==0){ $('#leftControl').hide() } else{ $('#leftControl').show() }
    
    // Hide right arrow if position is last slide
    if(pos==totalPages-1){ $('#rightControl').hide() } else{ $('#rightControl').show() }
}

function auto_play(){
	var keyword = $("#keyword").val();
	
	if(keyword!=""){
		return;	
	}
	
	var pos = parseInt($("#pageNum").val());
   	var totalPages = parseInt($("#totalPages").val());
   	
	if( totalPages <= 1 )
		return;
		
	pos = pos + 1;		
	if( pos > totalPages-1){
		
		pos = 0;
		
		$("#slide_anim").val("fadeout");
		
		$("#pageNum").val(pos);
		
		query_album();
	
		return;
	}
	
	$("#slide_anim").val("left");
	
	$("#pageNum").val(pos);
	
	query_album();
}

function start_timer(){
	if(g_autoplay_interval<=0) return;
	g_autoplay_timer = setInterval(auto_play, g_autoplay_interval);
}

function stop_timer(){
	clearInterval(g_autoplay_timer);
}

function resizeLayout(){
	
	if(parent.is_rwd_page==undefined){
		return;
	}
	
	if(parent.is_rwd_page()){
		if($("#maxRows").val()==1)
			return;
			
		$("#maxRows").val(1);
		
	}
	else{
		if($("#maxRows").val()==widget_slidecount_perpage)
			return;
			
		$("#maxRows").val(widget_slidecount_perpage);
	}
	
	var widget_slidecount_perpage = parseInt("5");
	var widget_slideshow_left_space = parseInt("42");
	var widget_slideshow_right_space = parseInt("34");
	var widget_slideshow_width = $(window).width() - widget_slideshow_left_space - widget_slideshow_right_space;
	$("#content").css("width", widget_slideshow_width);
		
	g_per_slide_width = Math.floor(widget_slideshow_width/$("#maxRows").val());
	
	if(parent.is_rwd_page()){
		g_per_slide_height = $(window).width();
		$("#content").css("height", g_per_slide_height);
	}
	else{
		g_per_slide_height = parseInt("125");
		$("#content").css("height", g_per_slide_height);
	}		
	
	g_slide_width = g_per_slide_width*$("#maxRows").val() + 2*$("#maxRows").val();
	
	$('#slideInner').css('width', g_slide_width * 2);
	$('#slideInner').css('overflow', 'hidden');
	
	query_album();
}

$(document).ready(function(){
	
	var widget_container_width = $(window).width();
	var widget_slideshow_left_space = parseInt("42");
	var widget_slideshow_right_space = parseInt("34");
	
	if(parent.is_rwd_page!=undefined){
		if(parent.is_rwd_page()){
			
			var padding_width = 10;
			
			widget_container_width = screen.width;
			
			$("#maxRows").val(1);
			
			widget_slideshow_left_space = padding_width;
			widget_slideshow_right_space = padding_width;
			
			g_per_slide_height = widget_container_width - widget_slideshow_left_space - widget_slideshow_right_space;
			
			$("#content").css("height", g_per_slide_height);
			$("#slideshow").css("left", padding_width);

			$("#main").css("background", "transparent");

			var main_height = $("#div_topbanner").height() + $("#content").height() + padding_width;
	
			if(parent.setWidgetHeight){	
				parent.setWidgetHeight("WID_0_20_cd5b990ed23629f17be17e5d90035ec683d2946f", main_height);	
			}
		}
	}
	
	var widget_slideshow_width = widget_container_width - widget_slideshow_left_space - widget_slideshow_right_space;
	$("#content").css("width", widget_slideshow_width);
		
	g_per_slide_width = Math.floor(widget_slideshow_width/$("#maxRows").val());
	
	$("#slideshow").mouseover(function(){
		stop_timer();
		
		// Hide / show controls
		manageControls();
	});
	
	$("#slideshow").mouseleave(function(){
		start_timer();
		
		$(".control").hide();
	});
	
	$('#search .button').click(function() {	
		stop_timer();
		
		$("#slide_anim").val("none");
			
		var keyword = $("#search .input").val();
		$("#keyword").val(keyword);
		$("#pageNum").val(0);
		
		query_album();
	});
	
	$('#search .input').keyup(function() {	
		stop_timer();
		
		$("#slide_anim").val("none");	
		
		var keyword = $("#search .input").val();
		$("#keyword").val(keyword);
		$("#pageNum").val(0);
		
		query_album();
	});
	
  	// Remove scrollbar in JS
  	$('#slidesContainer').css('overflow', 'hidden');
	
	// Insert controls in the DOM
  	$('#slideshow')
    .prepend('<span class="control" id="leftControl" title="向左滑動" alt="向左滑動"><div class="icon"></div></span>')
    .append('<span class="control" id="rightControl" title="向右滑動" alt="向右滑動"><div class="icon"></div></span>');
    
    $(".control").hide();
    
    $('.control').bind('click', function(){
		var pageNum = parseInt($("#pageNum").val());
		var totalPages = parseInt($("#totalPages").val());
		
		if($(this).attr('id')=='rightControl'){
			if(pageNum+1>=totalPages)
				pageNum = totalPages-1;
			else
				pageNum += 1;
				
			$("#slide_anim").val("left");
		}
		else {
			if(pageNum-1<=0)
				pageNum = 0;
			else
				pageNum -= 1;	
			
			$("#slide_anim").val("right");
		}
		
		$("#pageNum").val(pageNum);
		$("#totalPages").val(totalPages);
		
		// Hide / show controls
		manageControls();
		
		query_album();
	});
	
	$(".control").mouseover(function(){
		$(this).css("background-color", "#AAABAC");
	});
	
	$(".control").mouseleave(function(){
		$(this).css("background-color", "#6E7070");
	});
	
	g_slide_width = g_per_slide_width*$("#maxRows").val() + 2*$("#maxRows").val();
	
	$('#slideInner').css('width', g_slide_width * 2);
	$('#slideInner').css('overflow', 'hidden');
	
	query_album();
	
	start_timer();
});

</script>
</head>
<body>
<h2 style="display:none">activities2</h2>	
<div id="main" style="height:250px">	
<div id="div_topbanner">
		
</div>

<input name="keyword" type="hidden" id="keyword" value="">
<input name="pageNum" type="hidden" id="pageNum" value="3">
<input name="totalPages" type="hidden" id="totalPages" value="7">
<input name="slide_anim" type="hidden" id="slide_anim" value="left">
<input name="maxRows" type="hidden" id="maxRows" value="5">

<!-- Slideshow HTML -->
<div id="content" style="height: 125px; width: 0px;">
	<div id="slideshow" style="left:42px;top:100px"><span class="control" id="leftControl" title="向左滑動" alt="向左滑動" style="display: block;"><div class="icon"></div></span>
		<div id="slidesContainer" style="overflow: hidden;">
			<div id="slideInner" style="width: 0px; overflow: hidden; margin-left: 0px;"><div class="slide" style="float: left; width: 0px;"><a href="https://www.sgash.cyc.edu.tw/ischool/public/AlbumViewer/index.php?aid=203&amp;col=4&amp;maxRows=0" target="_blank" class="tab-ctl-x"><div class="slide_image" style="width:-16px;height:125px;"><img src="https://www.sgash.cyc.edu.tw/ischool/public/resource_view/thumb.php?file=37e284a77f52c7420b653001d4a80e66.jpg" title="藝術是反叛，藝術就是革命(另開啟新視窗)" alt="藝術是反叛，藝術就是革命(另開啟新視窗)" style="width:188px;height:125px;margin-left:-102px;"></div></a><a href="https://www.sgash.cyc.edu.tw/ischool/public/AlbumViewer/index.php?aid=204&amp;col=4&amp;maxRows=0" target="_blank" class="tab-ctl-x"><div class="slide_image" style="width:-16px;height:125px;"><img src="https://www.sgash.cyc.edu.tw/ischool/public/resource_view/thumb.php?file=89b7f4a6ac3ac3d0563b8cc4e41bd20f.jpg" title="文學行動展-文學力書寫LAN臺灣(另開啟新視窗)" alt="文學行動展-文學力書寫LAN臺灣(另開啟新視窗)" style="width:188px;height:125px;margin-left:-102px;"></div></a><a href="https://www.sgash.cyc.edu.tw/ischool/public/AlbumViewer/index.php?aid=180&amp;col=4&amp;maxRows=0" target="_blank" class="tab-ctl-x"><div class="slide_image" style="width:-16px;height:125px;"><img src="https://www.sgash.cyc.edu.tw/ischool/public/resource_view/thumb.php?file=ac27176fb451fb05c8b8fcf815bfecbb.jpg" title="111.12.09 開幕茶會-校慶藝文展「山林之美—王德合創作個展」(另開啟新視窗)" alt="111.12.09 開幕茶會-校慶藝文展「山林之美—王德合創作個展」(另開啟新視窗)" style="width:188px;height:125px;margin-left:-102px;"></div></a><a href="https://www.sgash.cyc.edu.tw/ischool/public/AlbumViewer/index.php?aid=197&amp;col=4&amp;maxRows=0" target="_blank" class="tab-ctl-x"><div class="slide_image" style="width:-16px;height:125px;"><img src="https://www.sgash.cyc.edu.tw/ischool/public/resource_view/thumb.php?file=0b0cba58060390ee9f7876bf74f13c96.jpg" title="111學年度班際排球賽(另開啟新視窗)" alt="111學年度班際排球賽(另開啟新視窗)" style="width:167.18913270637px;height:125px;margin-left:-91.594566353187px;"></div></a><a href="https://www.sgash.cyc.edu.tw/ischool/public/AlbumViewer/index.php?aid=196&amp;col=4&amp;maxRows=0" target="_blank" class="tab-ctl-x"><div class="slide_image" style="width:-16px;height:125px;"><img src="https://www.sgash.cyc.edu.tw/ischool/public/resource_view/thumb.php?file=ab6f5e6c39616c0322ca4dc56765f5d8.jpg" title="111學年度藝起璀璨-校慶運動會(另開啟新視窗)" alt="111學年度藝起璀璨-校慶運動會(另開啟新視窗)" style="width:188.23529411765px;height:125px;margin-left:-102.11764705882px;"></div></a></div></div>
		</div>
	<span class="control" id="rightControl" title="向右滑動" alt="向右滑動" style="display: block;"><div class="icon"></div></span></div>
</div>
<!-- End Slideshow HTML -->

</div>

</body></html>