function update_news_count(a){$.ajax({url:"update_news_clicks.php",data:"newsId="+a,type:"GET",dataType:"text",timeout:2E4,error:function(){},success:function(){}})}
function loadnews(a){var b=$("#ntb").attr("maxRows");if(parent.popup_content!=void 0)parent.popup_content("url","1000px","../../widget/site_news/news_pop_content.php?newsId="+a+"&maxRows_rsResult="+b+"&fh="+g_parent_height+"&bid="+g_board_id+"&uid="+g_unique_id);else{var e=g_parent_height,e=e==0?$(window).height():e,a="news_pop_content.php?newsId="+a+"&maxRows_rsResult="+b+"&fh="+e+"&bid="+g_board_id+"&uid="+g_unique_id;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?
window.location=a:(b=$(window).width()-100,e=$(window).height()-100,$(".popup-news .content").empty(),$(".popup-news").css("width",b),$(".popup-news").css("height",e),$(".popup-news").bPopup({content:"iframe",contentContainer:".content",loadUrl:a,positionStyle:"fixed",position:["auto",20],loadCallback:function(){var a=$(this).find("iframe");a.css("width",$(this).width()+"px");a.css("height",$(this).height()+"px");a.css("background","url()")}},function(){}))}}
function news_query_field(){var a=parseInt($("#ntb").attr("pageNum")),b=$("#ntb").attr("flock"),e=$("#ntb").attr("field"),i=$("#ntb").attr("fval"),g=$("#ntb").attr("order"),k=$("#ntb").attr("maxRows"),l=$("#ntb").attr("keyword"),f={};f.field=e;f.order=g;f.pageNum=a;f.maxRows=k;f.keyword=escape(l);if(i!="")f.fval=i;if(b!="")f.flock=b;f.uid=g_unique_id;f.tf=g_show_time_format;f.auth_type="user";$(".loading").css("left",($(window).width()-$(".loading").width())/2);$(".loading").css("top",($(window).height()-
$(".loading").height())/2);$(".loading").show();$.ajax({url:"./news_query_json.php",data:f,type:"POST",dataType:"json",timeout:2E4,error:function(){alert("Fail to load site news!")},success:function(a){build_json_table(a);adjustPageCtrlGUI();$(".loading").hide()}})}
function build_json_table(a){for(var b=a[0].flock,e=a[0].field,i=a[0].fval,g=a[0].order,k=a[0].maxRows,l=parseInt(a[0].pageNum),f=parseInt(a[0].totalPages),p=g_show_col_time,q=g_show_col_attr,r=g_show_col_unit,s=g_show_col_user,t=g_show_col_click,u=g_show_col_serial,v=g_title_percent,c="",n=0,d=1;d<a.length;d++){var h=a[d].newsId,w=a[d].time,x=a[d].attr,y=a[d].attr_name==""?"\u7121":a[d].attr_name,j=a[d].title,m=a[d].title_color,z=a[d].unit,o=a[d].unit_name==""?"\u7121":a[d].unit_name,A=a[d].issuer,
B=a[d].name==""?"\u7121":a[d].name,C=a[d].clicks,D=a[d].top,E=a[d].content_type,F=a[d].content,G=parseInt(a[d].permission);c+=n%2==0?'<tr nid="'+h+'" class="tcontent even">':'<tr nid="'+h+'" class="tcontent odd">';c+='<td style="text-align:center;width:2%" order="DESC" field="hot" axis="\u7f6e\u9802\u6d88\u606f" >';D=="1"&&(c+='<div id="imgHot"></div>');c+="</td>";u&&(c+='<td style="text-align:center;width:15%" order="DESC" field="serial" axis="\u7de8\u865f" >',c+=h,c+="</td>");p&&(c+='<td style="text-align:center;width:15%" order="DESC" field="time" axis="\u6642\u9593" >',
c+=w,c+="</td>");q&&(c+='<td style="text-align:center;width:15%" class="ctrl" order="DESC" field="attr" fval="'+x+'" axis="\u985e\u5225">\u3010'+y+"\u3011</td>");r&&(c+='<td style="text-align:center;width:10%" class="ctrl" order="DESC" field="unit" fval="'+z+'" title="'+o+'" axis="\u55ae\u4f4d">'+o+"</td>");c+='<td order="DESC" field="title" style="padding-left:5px;width:'+v+'%" axis="\u5167\u5bb9">';G>=1?(c+='<div id="imgLock"></div>',c+='<div style="float:left;width:90%;overflow:hidden;text-overflow:ellipsis;">'):
c+='<div style="overflow:hidden;text-overflow:ellipsis;">';E=="url"?c+='<a id="content_href" href="'+F+'" nid="'+h+'" title="'+j+'" target="_blank" onclick="update_news_count('+h+')">':g_news_open_mode==3?(c+='<a id="content_href" nid="'+h+'" title="'+j+'"',c+=' href="'+g_root_path+"public/news_view/show.php?nid="+h+'" target="_blank">'):c+='<a id="content_href" nid="'+h+'" title="'+j+'" onclick="loadnews('+h+')">';m!=""&&(c+='<span style="color:#'+m+'">');c+=j;m!=""&&(c+="</span>");c+="</a>";c+=
"</div>";c+="</td>";s&&(c+='<td style="text-align:center;width:10%" class="ctrl" order="DESC" field="issuer" fval="'+A+'" axis="\u767c\u4f48">'+B+"</a></td>");t&&(c+='<td style="text-align:center;width:10%" order="DESC" field="clicks" axis="\u9ede\u95b1">'+C+"</td>");c+="</tr>";n++}$("#ntb").attr("field",e);$("#ntb").attr("flock",b);$("#ntb").attr("fval",i);$("#ntb").attr("order",g);$("#ntb").attr("maxRows",k);$("#ntb").attr("pageNum",l);$("#ntb").attr("totalPages",f);$("#ntb tbody").html(c);adjustLayoutHeight()}
function adjustPageCtrlGUI(){var a=parseInt($("#ntb").attr("totalPages")),b=parseInt($("#ntb").attr("pageNum"))+1;a<=1?($("#btnFirst").addClass("disablebtn"),$("#btnPrev").addClass("disablebtn"),$("#btnNext").addClass("disablebtn"),$("#btnLast").addClass("disablebtn")):(b>1?($("#btnFirst").removeClass("disablebtn"),$("#btnPrev").removeClass("disablebtn")):($("#btnFirst").addClass("disablebtn"),$("#btnPrev").addClass("disablebtn")),b==a?($("#btnNext").addClass("disablebtn"),$("#btnLast").addClass("disablebtn")):
($("#btnNext").removeClass("disablebtn"),$("#btnLast").removeClass("disablebtn")))}
function adjustLayoutHeight(){var a=$(".topbanner-x").height()+$("#div_table_content").height()+$(".footer-x").height()+10;$("#div_news_table_1").css("height",$("#div_table_content").height());var b=$("#div_table_content").find("#ntb thead tr").eq(0).height();$("#div_news_table_1_topbanner").css("height",b);if(inIframe()&&parent.onLoadiFrmComplete&&window.frameElement.id=="iFrm")parent.onLoadiFrmComplete(a);else if(inIframe()&&parent.on_load_site_embed_pages_iFrm_complete&&window.frameElement.id==
"iFrm")parent.on_load_site_embed_pages_iFrm_complete(a);else if(parent.setWidgetHeight&&parent.setWidgetHeight(g_unique_id,a),g_maximize&&parent.setMainHeight?parent.setMainHeight(a):parent.adjustSectionSize&&parent.adjustSectionSize(),parent.onWidgetloaded)parent.onWidgetloaded(g_unique_id)}
function adjustTableLayout(){var a=parseInt($(".news_main").css("padding-left")),b=parseInt($(".news_main").css("padding-right")),e=$("body").width();$("#ntb thead").height();$("#ntb_bottom").height();g_maximize?($("#div_news_table_main").css("padding-left",0),$("#div_news_table_main").css("padding-right",0)):e-=a+b;$("#div_news_table_main").css("width",e);b=$("#div_news_table_main").width()-$("#div_news_table_1_topbanner_left").width()-$("#div_news_table_1_topbanner_right").width();$("#div_news_table_1_topbanner_center").css("width",
b);g_maximize||$("#div_table_content").css("left",a);$("#div_table_content").css("top",-3);$("#div_table_content").css("width",$("#div_news_table_main").width());screen.width<767&&$("#search").hide()}function inIframe(){try{return window.self!==window.top}catch(a){return!0}}var Browser={Version:function(){var a=999;navigator.appVersion.indexOf("MSIE")!=-1&&(a=parseFloat(navigator.appVersion.split("MSIE")[1]));return a}};
$(document).ready(function(){var a=g_content_height,a=g_maximize;adjustTableLayout();if(a){a=$(window).height()-$(".div_max_topbanner").height()-$("#ntb_bottom").height()-70;if($("#div_all_news_page_title").length>0){var b=$("#div_all_news_page_title").height()+20;a-=b}a=Math.floor(a/g_content_height)-1;$("#ntb").attr("maxRows",Math.max(a,g_maxRows))}else $("#ntb").attr("maxRows",g_maxRows);g_default_attr!=-1&&$("#ntb").attr("flock","attr_"+g_default_attr);news_query_field();$("#btnFirst").click(function(){if($(this).hasClass("disablebtn"))return!1;
$("#ntb").attr("pageNum",0);news_query_field()});$("#btnPrev").click(function(){if($(this).hasClass("disablebtn"))return!1;var a=parseInt($("#ntb").attr("pageNum"))-1;a<=0&&(a=0);$("#ntb").attr("pageNum",a);news_query_field()});$("#btnNext").click(function(){if($(this).hasClass("disablebtn"))return!1;var a=parseInt($("#ntb").attr("totalPages")),b=parseInt($("#ntb").attr("pageNum"))+1;b>=a&&(b=a);$("#ntb").attr("pageNum",b);news_query_field()});$("#btnLast").click(function(){if($(this).hasClass("disablebtn"))return!1;
var a=parseInt($("#ntb").attr("totalPages"))-1;$("#ntb").attr("pageNum",a);news_query_field()});$("#ntb thead tr th").click(function(){var a=$(this).attr("hid"),b=$(this).attr("order");$("#ntb").attr("field",a);$("#ntb").attr("fval","");$("#ntb").attr("order",b);$(this).attr("order",b=="DESC"?"ASC":"DESC");news_query_field();return!1});$("#ntb tbody tr td").livequery(function(){$(this).click(function(){var a=$(this).attr("field"),b=$(this).attr("fval");$(this).attr("order");if(!(a=="time"||a=="clicks"))if(a==
"title")return!0;else $("#ntb").attr("field","time"),$("#ntb").attr("fval",b),$("#ntb").attr("order","DESC"),$("#ntb").attr("pageNum",0),$("#ntb").attr("flock",a+"_"+b),news_query_field();return!1})});$("#search .button").click(function(){var a=$("#search .input").val();$("#ntb").attr("keyword",a);news_query_field()});$("#search .input").keyup(function(){var a=$("#search .input").val();$("#ntb").attr("keyword",a);news_query_field()});$("#search #select_attr, #search #select_unit").change(function(){var a=
$("#search #select_unit").val(),b=$("#search #select_attr").val(),g="";a!="-1"&&(g+="unit_"+a);b!="-1"&&(g!=""&&(g+="-"),g+="attr_"+b);$("#ntb").attr("flock",g);news_query_field()});g_show_search_unit==1?$("#search_unit").show():$("#search_unit").hide();g_show_search_attr==1?$("#search_attr").show():$("#search_attr").hide();$(window).resize(function(){adjustTableLayout()})});
