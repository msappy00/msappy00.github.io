(function(d){var g=(document.body||document.documentElement).style,i,h,r;g.transition!==void 0?i="transition":g.WebkitTransition!==void 0?i="-webkit-transition":g.MozTransition!==void 0?i="-moz-transition":g.MsTransition!==void 0?i="-ms-transition":g.OTransition!==void 0&&(i="-o-transition");g.transform!==void 0?h="transform":g.WebkitTransform!==void 0?h="-webkit-transform":g.MozTransform!==void 0?h="-moz-transform":g.MsTransform!==void 0?h="-ms-transform":g.OTransform!==void 0&&(h="-o-transform");
d.fn.gallerie=function(g){function v(a,c){var b=d(a),e=b.data("gallerie").options,f=d('<div class="gallerie-overlay"/>'),l=d('<div class="gallerie-imagebox"/>'),j=d('<img class="gallerie-image" alt="image viewer"/>'),g=d('<div class="gallerie-loading"/>');d('<div class="gallerie-control gallerie-close">&times;</div>');var w=d('<div class="gallerie-captionbox"><div class="gallerie-control gallerie-playpause-control gallerie-control-play"></div><div class="gallerie-control gallerie-control-first"></div><div class="gallerie-control gallerie-control-previous"></div><div class="gallerie-control gallerie-showhide-control gallerie-down-control"></div><div class="gallerie-text"><div class="gallerie-title"/><div class="gallerie-index"/></div><div class="gallerie-control gallerie-control-next"></div><div class="gallerie-control gallerie-control-last"></div><div class="gallerie-control gallerie-control-full"></div></div>'),
m=d("<ul></ul>"),o=d('<div class="gallerie-thumbbox"/>'),k,p;d.each(c,function(a,b){p=d(b);k=d(b).find("img");k=d("<li></li>").append(d("<a />").prop({href:p.prop("href")}).append(d("<img/>").prop({src:k.prop("src"),title:k.prop("title"),alt:k.prop("title")})));m.append(k)});f.append(l.append(j).append(g)).append(w).append(o.append(m));f.on("click.gallerie",".gallerie-close",function(){b.gallerie("close")});f.on("click.gallerie",".gallerie-control-first",function(){b.gallerie("pause");b.gallerie("first");
return!1});f.on("click.gallerie",".gallerie-control-last",function(){b.gallerie("pause");b.gallerie("last");return!1});f.on("click.gallerie",".gallerie-control-full",function(){b.gallerie("full");document.addEventListener(screenfull.raw.fullscreenchange,function(){setTimeout(function(){$fullCtrl=b.find(".gallerie-control-full");screenfull.isFullscreen?$fullCtrl.hide():$fullCtrl.show();b.gallerie("pause");b.gallerie("hideControl")},1E3)});return!1});f.on("click.gallerie",".gallerie-upload-facebook",
function(){b.gallerie("facebook");return!1});f.on("click.gallerie",".gallerie-control-previous",function(){b.gallerie("pause");b.gallerie("previous");return!1});f.on("click.gallerie",".gallerie-control-next",function(){b.gallerie("pause");b.gallerie("next");return!1});f.on("click.gallerie",".gallerie-showhide-control",function(){b.gallerie("showHideControl");return!1});f.on("click.gallerie",".gallerie-control-play",function(){b.gallerie("play");return!1});f.on("click.gallerie",".gallerie-control-pause",
function(){b.gallerie("pause");return!1});var n=0;o.mousemove(function(a){var b=e.thumbboxTriggerWidth,c=m.outerWidth(),f=d(window).width();b<1&&(b*=f);var j=n;n=a.pageX<b?0:f-a.pageX<b?1:-1;j!=n&&(s(m),n<0||(a=0,h!==void 0&&i!==void 0?(b=m.css(h),b=b.substr(7,b.length-8).split(","),b.length>4&&(a=parseInt(b[4]))):a=parseInt(m.css("left"),10),c=-(n*c)+f*n,t(m,c,{duration:Math.abs(c-a)*1/e.thumbboxSpeed,easing:"linear"})))}).mouseleave(function(){s(m);n=-1});f.find(".gallerie-thumbbox li").on("click.gallerie",
function(a){var c=d(this).find("a:first")[0];b.gallerie("open",c);a.preventDefault();a.stopPropagation()}).hover(function(){d(this).addClass("gallerie-thumbbox-hover")},function(){d(this).removeClass("gallerie-thumbbox-hover")});b.find(".gallerie-overlay").remove();b.append(f.hide());return f}function s(a){if(i!==void 0){var c={};if(h!==void 0){var b=a.css(h),b=b.substr(7,b.length-8).split(",");c[h]="translate("+b[4]+"px)";c[i]=h+" 0ms"}else c.left=a.css("left"),c[i]="left 0ms";a.css(c)}else a.clearQueue().stop()}
function t(a,c,b){if(i!==void 0){b.easing==void 0&&(b.easing="ease");var d={};h!==void 0?(d[h]="translate("+c+"px)",d[i]=h+" "+b.duration+"ms "+b.easing):(d.left=c,d[i]="left "+b.duration+"ms "+b.easing);a.css(d)}else a.animate({left:c},b)}function u(a){a instanceof d.Event&&(a=a.data);var c=a.preloadImage,b=a.$image,e=b.closest(".gallerie-imagebox");$imageLoading=a.$imageLoading;maxWidth=e.width()-b.outerWidth()+b.width();maxHeight=e.height()-b.outerHeight()+b.height();width=height=0;if(c==b.data("preloadImage"))width=
c.width>maxWidth?maxWidth:c.width,height=c.height*width/c.width,height>maxHeight&&(height=maxHeight,width=c.width*height/c.height),a=c.src,a+="&update_hits_count=0",b.prop({src:a,title:c.title}).css({width:width,height:height}).removeClass("loading"),$imageLoading.hide()}var q={init:function(a){a=d.extend({thumbboxTriggerWidth:0.1,thumbboxSpeed:0.5,imageEvent:"click",elem:".slide_image>a",wrapAround:!0},a);return this.each(function(){var c=d(this);c.data("gallerie");c.data("gallerie",{options:a,target:c});
c.gallerie("load",a.elem);c.gallerie("setImage",1,!1)})},setImage:function(a,c){return this.each(function(){var b=d(this);b.data("gallerie");var e=b.find(".gallerie-overlay"),f=b.find(".gallerie-thumbbox"),l=b.find(".gallerie-captionbox"),b=f.find("ul:first"),j=d.type(a),g,h,i;j=="number"?a=b.find("li a")[a-1]:j=="string"&&(a=d("<a/>").prop("href",a)[0]);if(a==void 0)return!1;j=d(a);g=e.find(".gallerie-image");i=e.find(".gallerie-loading");g.addClass("loading");h=new Image;var o={preloadImage:h,$image:g,
$imageLoading:i};d(h).on("load.gallerie",o,u);g.data("preloadImage",h);e=j.prop("href");e+=c?"&update_hits_count=1":"&update_hits_count=0";h.src=e;setTimeout(function(){h.complete||(i.show(),h.complete&&u(o))},100);var k=f.find(a);if(k.length==0){var p=j.prop("href");f.find("a").each(function(b,a){if(d(a).prop("href")==p)return k=d(a),!1})}e=k.closest("li");f.find(".gallerie-thumbbox-selected").removeClass("gallerie-thumbbox-selected");e.addClass("gallerie-thumbbox-selected");j=f.find("li");f=j.index(e)+
1;j=j.length;l.find(".gallerie-title").text(e.find("img").prop("title"));l.find(".gallerie-index").text(f+" of "+j);f=e.position().left+e.outerWidth(!0)/2;l=d(window).width();if(e.offset().left<0||f>l)f=Math.max(0,-(l/2-f)),f=Math.min(b.outerWidth()-l,f),b.clearQueue(),t(b,-f,{duration:1E3})})},isOpen:function(){return d(this[0]).find(".gallerie-overlay").is(":visible")},open:function(a){return this.each(function(){var c=d(this);c.data("gallerie");var b=c.find(".gallerie-overlay"),e=c.find(".gallerie-imagebox"),
f=c.find(".gallerie-captionbox"),g=c.find(".gallerie-thumbbox");d(a).attr("data-type")=="folder"?(d(a).attr("href"),window.location=href):(b.is(":hidden")&&(d(document).on("keyup.gallerie",function(a){a.keyCode==13||a.keyCode==27?c.gallerie("close"):a.keyCode==37?(c.gallerie("pause"),c.gallerie("previous")):a.keyCode==39&&(c.gallerie("pause"),c.gallerie("next"))}),d("body").css({overflow:"hidden"}),e.css({height:b.height()-f.outerHeight()-g.outerHeight()-parseInt(e.css("margin-bottom"),10)-parseInt(e.css("margin-top"),
10)})),b.fadeIn(500,function(){a&&c.gallerie("setImage",a,!0)}),b.click(function(){c.gallerie("close")}),c.gallerie("hideControl"))})},close:function(){return this.each(function(){d(this).find(".gallerie-overlay").hide();d(this).find(".gallerie-source").show();d(document).off("keyup.gallerie");d("body").css({overflow:"inherit"});d("#gallery-desc").show()})},next:function(){return this.each(function(){var a=d(this),c=a.data("gallerie").options,b=a.find(".gallerie-thumbbox"),e=b.find(".gallerie-thumbbox-selected").next();
if(e.length==0){if(!c.wrapAround)return;e=b.find("li:first")}a.gallerie("setImage",e.find("a"),!0)})},first:function(){return this.each(function(){var a=d(this),c=a.data("gallerie").options,b=a.find(".gallerie-thumbbox");b.find(".gallerie-thumbbox-selected");var e=b.find("li:first");if(e.length==0){if(!c.wrapAround)return;e=b.find("li:last")}a.gallerie("setImage",e.find("a"),!0)})},last:function(){return this.each(function(){var a=d(this),c=a.data("gallerie").options,b=a.find(".gallerie-thumbbox");
b.find(".gallerie-thumbbox-selected");var e=b.find("li:last");if(e.length==0){if(!c.wrapAround)return;e=b.find("li:last")}a.gallerie("setImage",e.find("a"),!0)})},previous:function(){return this.each(function(){var a=d(this),c=a.data("gallerie").options,b=a.find(".gallerie-thumbbox"),e=b.find(".gallerie-thumbbox-selected").prev();if(e.length==0){if(!c.wrapAround)return;e=b.find("li:last")}a.gallerie("setImage",e.find("a"),!0)})},play:function(){return this.each(function(){var a=d(this);a.data("gallerie");
var c=a.find(".gallerie-playpause-control");c.removeClass("gallerie-control-play");c.addClass("gallerie-control-pause");r=setInterval(function(){a.gallerie("next")},3E3)})},pause:function(){return this.each(function(){var a=d(this);a.data("gallerie");a=a.find(".gallerie-playpause-control");a.removeClass("gallerie-control-pause");a.addClass("gallerie-control-play");clearInterval(r)})},load:function(a){return this.each(function(){var c=d(this),b=c.data("gallerie").options;a===void 0&&(a=b.elem);v(this,
c.find(a).toArray());d(document).on(b.imageEvent+".gallerie",a,function(a){c.gallerie("open",this);a.stopPropagation();a.preventDefault()})})},full:function(){return this.each(function(){screenfull.enabled&&screenfull.request()})},option:function(a,c){var b={};if(c===void 0&&d.type(a)!="string")b=a;else if(c===void 0)return d(this[0]).data("gallerie").options[a];else b={},b[a]=c;return this.each(function(){var a=d(this),c=a.data("gallerie"),g=c.options;d.each(b,function(b,c){b=="elem"||b=="imageEvent"?
(d(document).off(g.imageEvent+".gallerie",g.elem),g[b]=c,d(document).on(g.imageEvent+".gallerie",g.elem,function(b){a.gallerie("open",this);b.stopPropagation();b.preventDefault()})):b in g&&(g[b]=c)});c.options=g;a.data("gallerie",c)})},showHideControl:function(){var a=d(this),c=a.find(".gallerie-overlay"),b=a.find(".gallerie-imagebox"),e=a.find(".gallerie-captionbox"),f=a.find(".gallerie-thumbbox"),g=a.find(".gallerie-thumbbox-selected"),h=a.find(".gallerie-showhide-control");f.is(":hidden")?(h.removeClass("gallerie-up-control"),
h.addClass("gallerie-down-control"),f.show(),b.css({height:c.height()-e.outerHeight()-f.outerHeight()-parseInt(b.css("margin-bottom"),10)-parseInt(b.css("margin-top"),10)})):(h.removeClass("gallerie-down-control"),h.addClass("gallerie-up-control"),f.hide(),b.css({height:c.height()-e.outerHeight()-parseInt(b.css("margin-bottom"),10)-parseInt(b.css("margin-top"),10)}));a.gallerie("setImage",g.find("a"),!1)},hideControl:function(){var a=d(this),c=a.find(".gallerie-overlay"),b=a.find(".gallerie-imagebox"),
e=a.find(".gallerie-captionbox"),f=a.find(".gallerie-thumbbox"),g=a.find(".gallerie-thumbbox-selected"),h=a.find(".gallerie-showhide-control");h.removeClass("gallerie-down-control");h.addClass("gallerie-up-control");f.hide();b.css({height:c.height()-e.outerHeight()-parseInt(b.css("margin-bottom"),10)-parseInt(b.css("margin-top"),10)});a.gallerie("setImage",g.find("a"),!1)},facebook:function(){if(g_upload_facebook_dialog==null)alert("g_upload_facebook_dialog is null");else{var a=d(".gallerie-image").attr("src");
g_upload_facebook_dialog.data("url",a).dialog("open")}}};if(q[g])return q[g].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof g==="object"||!g)return q.init.apply(this,arguments);else d.error("Method "+g+" does not exist on jQuery.gallerie")}})(jQuery);
